---
kubeconfig_path: "/home/{{install.os.non_root_user.name}}/.kube/config"

# to create prod certificates --extra-vars '{le_staging:false}'
le_staging: true

k3s:
  node_token_path: "/var/lib/rancher/k3s/server/node-token"

  manifests_path: "/var/lib/rancher/k3s/server/manifests/"

  # Packages required for Ansible to issue Kubernetes and commands
  packages:
    - python3-pip
  packages_pip:
    - openshift
    - pyyaml
    - kubernetes

  k3s_init_options: >-
    {% if groups['k3s_control'] | length > 1 -%}
    {% if inventory_hostname == groups['k3s_control'][0] -%}
    --cluster-init
    {%- else %}
    --server https://{{ groups['k3s_control'][0] }}:6443
    {%- endif %}
    --token {{ K3S_TOKEN|default('top_secret') }}
    {%- endif %}

  # This becomes the "INSTALL_K3S_EXEC=" CLI parameter
  k3s_exec_options:
    - "{{k3s_cli_var|default('')}}"         # Options set in inventory or hosts vars

  # When containerd for ZFS is enabled, this will be added to k3s_exec_options
  k3s_containerd_options:
    - "--container-runtime-endpoint unix:///run/containerd/containerd.sock"

  # When "disable_local_path_as_default_storage_class = true" this will be added to k3s_exec_options
  cli_disable_storage_options:              
    - "--disable local-storage"   

  # When "install.metallb.enabled == true" or "install.kube_vip.lb.enabled == true"
  # this will be added to k3s_exec_options
  cli_disable_loadbalancer_options:        
    - "--disable servicelb"

  traefik:
    # Generate Staging Certificates - the "le_staging" allows for CLI override.
    staging: "ternary(({{le_staging|default(true)}})|true,false)"
    
    # Define the name of the API token key stored in k3s_traefik_api_secrets.yml
    le_api_token_name: "{{CF_DNS_API_TOKEN}}"

    # Define the name of the email address key associated to the API token stored in k3s_traefik_api_secrets.yml
    le_api_token_email: "{{CF_AUTH_EMAIL}}"

    # Define the name of the Let's Encrypt Email Address key stored in k3s_traefik_api_secrets.yml
    le_email_auth: "{{LE_AUTH_EMAIL}}"

    le_staging_server: "https://acme-staging-v02.api.letsencrypt.org/directory"
    le_production_server: "https://acme-v02.api.letsencrypt.org/directory"

    # Define the name of the Let's Encrypt Domain List Key stored in k3s_traefik_api_secrets.yml
    le_domains: "{{LE_DOMAINS}}"

    dashboard_users: "{{TRAEFIK_DASHBOARD_USERS}}"
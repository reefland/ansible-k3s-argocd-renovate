# Reference: https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack/values.yaml

prometheus:
  prometheusSpec:
    storageSpec:
      ## Using PersistentVolumeClaim
      ##
      volumeClaimTemplate:
        spec:
          storageClassName: {{install.prometheus_operator.prometheus.storage_claim.class_name}}
          accessModes: 
            - {{install.prometheus_operator.prometheus.storage_claim.access_mode}}
          resources:
            requests:
              storage: {{install.prometheus_operator.prometheus.storage_claim.claim_size}}

    retention: {{install.prometheus_operator.prometheus.retention}}
{% if install.prometheus_operator.prometheus.dashboard.path is defined %}
    externalUrl: {{install.prometheus_operator.prometheus.dashboard.path}}
{% endif %}

# Graphana values
# Reference: https://github.com/grafana/helm-charts/blob/main/charts/grafana/values.yaml

grafana:
  ingress:
    path: {{install.prometheus_operator.grafana.dashboard.path}}
  grafana.ini:
    server:
      root_url: https://{{install.prometheus_operator.grafana.dashboard.hostname|default(ansible_fqdn)|lower}}{{install.prometheus_operator.grafana.dashboard.path}}/
  persistence:
    type: pvc
    enabled: true
    storageClassName: {{install.prometheus_operator.grafana.storage_claim.class_name}}
    accessModes: 
      - {{install.prometheus_operator.grafana.storage_claim.access_mode}}
    size: {{install.prometheus_operator.grafana.storage_claim.claim_size}}
    # annotations: {}
    finalizers:
      - kubernetes.io/pvc-protection
    # selectorLabels: {}
    # subPath: ""
    # existingClaim:

# AlertManager values
# Reference: https://prometheus.io/docs/alerting/latest/configuration/

alertmanager:
  # Reference: https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/api.md#alertmanagerspec
  alertmanagerSpec:
    # https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/user-guides/storage.md
    storage:
      volumeClaimTemplate:
        spec:
          storageClassName: {{install.prometheus_operator.alertmanager.storage_claim.class_name}}
          accessModes: 
            - {{install.prometheus_operator.alertmanager.storage_claim.access_mode}}
          resources:
            requests:
              storage: {{install.prometheus_operator.alertmanager.storage_claim.claim_size}}
  config:
    global:
      resolve_timeout: 5m
    # Reference: https://prometheus.io/docs/alerting/latest/configuration/
    route:
      receiver: default-receiver
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 4h
      group_by: [cluster, alertname]
      # All alerts that do not match the following child routes
      # will remain at the root node and be dispatched to 'default-receiver'.
      #routes:
      #  - matchers:
      #    - service=~"foo1|foo2|baz"
      #  receiver: database-team
      routes: []
{% if prometheus_operator.alertmanager.receivers is defined %}{% filter indent(width=4) %}
    {{prometheus_operator.alertmanager.receivers}}{% endfilter %}
{% else %}
    receivers: []
{% endif -%}


# Configuration Values for Helm for Alert Configurations
# Reference: https://prometheus.io/docs/alerting/latest/configuration/
---
apiVersion: v1
kind: Secret
metadata:
  name: alertmanager-kube-prometheus-stack-alertmanager-config
  namespace: {{install.prometheus_operator.namespace}}
stringData:
  alertmanager.yaml: |
    global:
      resolve_timeout: 5m
    route:
      receiver: default-receiver
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 4h
      group_by: [cluster, alertname]
      # All alerts that do not match the following child routes
      # will remain at the root node and be dispatched to 'default-receiver'.
      routes:
      #  - matchers:
      #    - service=~"foo1|foo2|baz"
      #  receiver: database-team
    receivers:
{% if VAULT_SLACK_CONFIG_API_URL_SECRET is defined %}
    - name: 'default-receiver'
      # https://prometheus.io/docs/alerting/latest/configuration/#slack_config
      slack_configs:
        - api_url: "{{VAULT_SLACK_CONFIG_API_URL_SECRET}}"
          send_resolved: true
          channel: 'monitoring'
          {% raw %}text: "{{ range .Alerts }}<!channel> {{ .Annotations.summary }}\n{{ .Annotations.description }}\n{{ end }}"{% endraw %}
{% endif %}